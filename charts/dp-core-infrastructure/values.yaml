#
# Copyright Â© 2023 - 2024. Cloud Software Group, Inc.
# This file is subject to the license terms contained
# in the license file that is distributed with this file.
#


# Default values for dp-core-infrastructure.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  tibco:
    dataPlaneId: "abcd"
    subscriptionId: "sub1"
    cpHostName: "https://account.local.cic2.pro"  # Control Plane DNS domain
    serviceAccount: ""                                 # customer provided service account
    containerRegistry:
      url: "reldocker.tibco.com"
      # username: "test" # [optional] Create a imagePullSecret named <dpId> for private container registry.
      # password: "test"
      # email: "tibco-plt@cloud.com"
  # httpProxy:
  #   httpProxyUrl:
  #   httpsProxyUrl:
  #   noProxy: .local, .internal
  logging:
    fluentbit:
      enabled: true

    # The fluentbit configuration section.
    # It specifies that the fluentbit should not run as a non-root user and the user ID should be 0 (root).
    # Privilege escalation is not allowed for security reasons.
    # Additionally, it drops all capabilities, which is a common security practice to minimize potential risks.
    # GitHub issue: https://github.com/fluent/fluent-bit/issues/872#issuecomment-827763207, https://github.com/kyma-project/kyma/pull/11657/files
      securityContext:
        runAsNonRoot: false
        runAsUser: 0
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL

tp-tibtunnel:
  enabled: true
  connect:
    debug: true  # Enable debug logging
    payload: false  # Display payload data in the debug logs. Requires flag 'debug'. WARNING: Payload might contain sensitive data!
    dataChunkSize: ""  # Set the max size(in KB) of data for a single read/write operation, default is 32
    dataAckMode: false  # Enable/disable data ack
    remoteDebug: true  # Enable debug logging of this tunnel connection inside application (running in TIBCO Cloud)
    logFile: ""  # Full path to the output log file. If not specified, the logs will be printed on stdout
    configDir: ""  # Full path to the directory where to store the configuration file(s) (default "~/.tibtunnel")
    networkCheckUrl: "https://www.google.com"  # Url to check for network connectivity
    infiniteRetries: false  # Irrespective of any error, keep trying to discover and connect to establish hybrid connectivity
    url: ""  # Connect Url generated from TIBCO Cloud Control plane
    onPremHost: "cpdpproxy"  # service name of on prem host
    onPremPort: "80"  # port number of the service.
  configure:
    profile: ""  # The name of the profile to create or update
    accessKey: "abc"  # Specify the TIBCO AccessKey secret to be used for authentication

tp-provisioner-agent:
  enabled: true

haproxy:
  nameOverride: haproxy
  fullnameOverride: cpdpproxy
  enabled: true
  rbac:
    create: false
  serviceAccount:
    create: false
    name: "{{ .Values.global.tibco.serviceAccount }}"
  controller:
    ingressClassResource:
      name: tibco-dp-{{ .Values.global.tibco.dataPlaneId }}
    ingressClass: tibco-dp-{{ .Values.global.tibco.dataPlaneId }}
    extraArgs:
    - --namespace-whitelist={{ .Release.Namespace }}
    service:
      type: ClusterIP
      enabled: true
    existingImagePullSecret: "{{ .Values.global.tibco.dataPlaneId }}"
    podLabels:
      # allow k8s api access
      networking.platform.tibco.com/kubernetes-api: enable
config:
  enabled: true
