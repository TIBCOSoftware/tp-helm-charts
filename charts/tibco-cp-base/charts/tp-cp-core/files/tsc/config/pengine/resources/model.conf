[request_definition]
# r = subject, domain, object, action
# subject = orgId_userId  // check for org_user has permissions
# OR subject = orgId_groupId // check for user's org_group has permissions
# OR subject = orgId_userId_deny // check for org_user's permissions prohibited
# OR subject = orgId_groupId_deny // check for org_group's permissions prohibited
# domain = dataplaneId
# object = contributingResource
# action = action
r = org_user_or_org_group, dp, contributingResource, action

[policy_definition]
# p = subject, domain, object, action, description
# subject = role(s) defined by TIBCO Capabilities (tenants)
# domain = applies to contributingResources
# object = contributingResource
# action = action as defined by TIBCO Capabilities (tenants) (read, write, delete)
# description = role description
# metadata = metadata
p = role, appliesTo, contributingResource, action, description, metadata
#TODO - When policy definitons are stable, increment Schema version in sql scripts

[role_definition]
# case 1: orgId_groupId, role (access allowed rule for specific group for all dataplanes)
# case 2: orgId_userId, role (access allowed rule for specific user for all dataplanes))
# case 3: orgId_groupId, role, resource (access allowed rule for specific group for specific dataplane)
# case 4: orgId_userId, role, resource (access allowed rule for specific user for specific dataplane)

# case 5: orgId_groupId|DENY (access denied rule for specific group for all dataplanes)
# case 6: orgId_userId|DENY (access denied rule for specific user for all dataplanes)
# case 7: orgId_groupId|DENY, role, resource (access denied rule for specific group for specific dataplane)
# case 8: orgId_userId|DENY, role, resource (access denied rule for specific user for specific dataplane)
# (NOTE: '|DENY' is suffix added by permissions engine to define access denied rule)
g = _, _
g2 = _, _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = g(r.org_user_or_org_group, p.role) && keyMatch(r.contributingResource , p.contributingResource) && keyMatch(r.action , p.action) || g2(r.org_user_or_org_group, p.role, r.dp) && keyMatch(r.contributingResource , p.contributingResource) && keyMatch(r.action , p.action)
